# -*- coding: utf-8 -*-
"""
Tencent is pleased to support the open source community by making BK-BASE 蓝鲸基础平台 available.

Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.

BK-BASE 蓝鲸基础平台 is licensed under the MIT License.

License for BK-BASE 蓝鲸基础平台:
--------------------------------------------------------------------
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
documentation files (the "Software"), to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
"""

import json
import re

import httpretty as hp
from conf import dataapi_settings
from datahub.databus.settings import META_API_URL, STOREKIT_API_URL

OLD_DATABUS_API_URL = getattr(dataapi_settings, "OLD_DATABUS_API_URL", "")


def post_ok():
    hp.register_uri(hp.POST, META_API_URL + "result_tables/", body=json.dumps({"result": True}))


def put_ok():
    hp.register_uri(
        hp.PUT,
        re.compile(META_API_URL + "result_tables/*/"),
        body=json.dumps({"result": True}),
    )


def get_2_output_ok():
    hp.register_uri(
        hp.GET,
        META_API_URL + "result_tables/2_output/",
        body=json.dumps(
            {
                "errors": {},
                "message": "ok",
                "code": "1500200",
                "result": True,
                "data": {
                    "bk_biz_id": 2,
                    "project_id": 2331,
                    "result_table_id": "2_output",
                    "result_table_name": "output",
                    "result_table_name_alias": "output_alias",
                    "processing_type": "clean",
                    "sensitivity": "output_alias",
                    "created_by": "committer",
                    "created_at": "2018-09-19 17:03:50",
                    "updated_by": None,
                    "updated_at": "2018-09-19 17:03:50",
                    "description": "输出",
                    "concurrency": 0,
                    "data_processing": {
                        "project_id": 1,
                        "processing_id": "xxx",
                        "processing_name": "xxx",
                        "processing_type": "xxx",
                        "created_by ": "xxx",
                        "created_at": "xxx",
                        "updated_by": "xxx",
                        "updated_at": "xxx",
                        "description": "xxx",
                    },
                    "count_freq": 3600,
                    "tags": {"manage": {"geog_area": [{"code": "inland"}]}},
                    "fields": [
                        {
                            "id": 13730,
                            "result_table_id": "2_output",
                            "field_index": 1,
                            "field_name": "timestamp",
                            "field_alias": "时间",
                            "description": "",
                            "field_type": "timestamp",
                            "is_dimension": 0,
                            "origins": "",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        }
                    ],
                    "storages": {
                        "mysql": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "xxx",
                                "cluster_type": "mysql",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "mysql.host", "port": 3306, "user": "mysqluser", '
                                '"password":""}',
                                "priority": 234,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "xxx",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "kafka": {
                            "id": 1000,
                            "storage_channel_id": 1000,
                            "result_table_id": "xxx",
                            "storage_cluster": {},
                            "storage_channel": {
                                "id": 1000,
                                "cluster_name": "xxx",
                                "cluster_type": "kafka",
                                "cluster_role": "inner",
                                "cluster_domain": "xxx",
                                "cluster_backup_ips": "xxx",
                                "cluster_port": 2432,
                                "zk_domain": "127.0.0.1",
                                "zk_port": 3481,
                                "zk_root_path": "/abc/defg",
                                "priority": 234,
                                "attribute": "bkdata",
                                "description": "sdfdsf",
                            },
                            "physical_table_name": "xxx",
                            "expires": "xxx",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "hdfs": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "hdfs_test",
                                "cluster_type": "hdfs",
                                "cluster_domain": "xxx",
                                "cluster_group": "hdfs",
                                "connection_info": '{"flush_size": 1000000, "servicerpc_port": 53310, "hdfs_url": '
                                '"hdfs://hdfsTest", "rpc_port": 9000, "interval": 60000, "ids": '
                                '"nn1", "hdfs_cluster_name": "hdfsTest", "topic_dir": "/kafka/data/"'
                                ', "log_dir": "/kafka/logs", "hdfs_default_params": '
                                '{"dfs.replication": 2}, "hosts": "test-master-01", "port": 8081}',
                                "priority": 2,
                                "version": "1234",
                                "belongs": "bkdata",
                            },
                            "storage_channel": {},
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "es": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "es-test",
                                "cluster_type": "es",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "transport": 9300}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "370",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tredis": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tredis-test",
                                "cluster_type": "tredis",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 30000, "password": ""}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "7d",
                            "storage_config": '{"storage_type": "list", "storage_expire_days": 7}',
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "druid": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "druid-test",
                                "cluster_type": "druid",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "zookeeper.connect": "XXXXXX"}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "queue": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "queue-test",
                                "cluster_type": "queue",
                                "cluster_domain": "xxx",
                                "cluster_group": "queue",
                                "connection_info": '{"host": "XXXXXXX", "port": 9092}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "14d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tsdb": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tsdb-test",
                                "cluster_type": "tsdb",
                                "cluster_domain": "xxx",
                                "cluster_group": "tsdb",
                                "connection_info": '{"connector_cluster":"tsdb-inner2-M", "tsdb_url": "xxx", "host": '
                                '"localhost", "port": 7085}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "30d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                    },
                },
            }
        ),
    )


def get_2_output_storage_ok():
    hp.register_uri(
        hp.GET,
        META_API_URL + "result_tables/2_output/storages/",
        body=json.dumps(
            {
                "errors": {},
                "message": "ok",
                "code": "1500200",
                "result": True,
                "data": {
                    "bk_biz_id": 2,
                    "project_id": 2331,
                    "result_table_id": "2_output",
                    "result_table_name": "output",
                    "result_table_name_alias": "output_alias",
                    "processing_type": "clean",
                    "sensitivity": "output_alias",
                    "created_by": "committer",
                    "created_at": "2018-09-19 17:03:50",
                    "updated_by": None,
                    "updated_at": "2018-09-19 17:03:50",
                    "description": "输出",
                    "concurrency": 0,
                    "data_processing": {
                        "project_id": 1,
                        "processing_id": "xxx",
                        "processing_name": "xxx",
                        "processing_type": "xxx",
                        "created_by ": "xxx",
                        "created_at": "xxx",
                        "updated_by": "xxx",
                        "updated_at": "xxx",
                        "description": "xxx",
                    },
                    "count_freq": 3600,
                    "tags": {"manage": {"geog_area": [{"code": "inland"}]}},
                    "fields": [
                        {
                            "id": 13730,
                            "result_table_id": "2_output",
                            "field_index": 1,
                            "field_name": "timestamp",
                            "field_alias": "时间",
                            "description": "",
                            "field_type": "timestamp",
                            "is_dimension": 0,
                            "origins": "",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        }
                    ],
                    "storages": {
                        "mysql": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "xxx",
                                "cluster_type": "mysql",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "mysql.host", "port": 3306, "user": "mysqluser", '
                                '"password":""}',
                                "priority": 234,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "xxx",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "kafka": {
                            "id": 1000,
                            "storage_channel_id": 1000,
                            "result_table_id": "xxx",
                            "storage_cluster": {},
                            "storage_channel": {
                                "id": 1000,
                                "cluster_name": "xxx",
                                "cluster_type": "kafka",
                                "cluster_role": "inner",
                                "cluster_domain": "xxx",
                                "cluster_backup_ips": "xxx",
                                "cluster_port": 2432,
                                "zk_domain": "127.0.0.1",
                                "zk_port": 3481,
                                "zk_root_path": "/abc/defg",
                                "priority": 234,
                                "attribute": "bkdata",
                                "description": "sdfdsf",
                            },
                            "physical_table_name": "xxx",
                            "expires": "xxx",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "hdfs": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "hdfs_test",
                                "cluster_type": "hdfs",
                                "cluster_domain": "xxx",
                                "cluster_group": "hdfs",
                                "connection_info": '{"flush_size": 1000000, "servicerpc_port": 53310, "hdfs_url": '
                                '"hdfs://hdfsTest", "rpc_port": 9000, "interval": 60000, "ids": '
                                '"nn1", "hdfs_cluster_name": "hdfsTest", "topic_dir": "/kafka/data/"'
                                ', "log_dir": "/kafka/logs", "hdfs_default_params": '
                                '{"dfs.replication": 2}, "hosts": "test-master-01", "port": 8081}',
                                "priority": 2,
                                "version": "1234",
                                "belongs": "bkdata",
                            },
                            "storage_channel": {},
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "es": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "es-test",
                                "cluster_type": "es",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "transport": 9300}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "370",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tredis": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tredis-test",
                                "cluster_type": "tredis",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 30000, "password": ""}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "7d",
                            "storage_config": '{"storage_type": "list", "storage_expire_days": 7}',
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "druid": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "druid-test",
                                "cluster_type": "druid",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "zookeeper.connect": "XXXXXX"}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "queue": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "queue-test",
                                "cluster_type": "queue",
                                "cluster_domain": "xxx",
                                "cluster_group": "queue",
                                "connection_info": '{"host": "XXXXXXX", "port": 9092}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "14d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tsdb": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tsdb-test",
                                "cluster_type": "tsdb",
                                "cluster_domain": "xxx",
                                "cluster_group": "tsdb",
                                "connection_info": '{"connector_cluster":"tsdb-inner2-M", "tsdb_url": "xxx", "host": '
                                '"localhost", "port": 7085}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "30d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                    },
                },
            }
        ),
    )


def post_2_output_ok():
    hp.register_uri(
        hp.POST,
        STOREKIT_API_URL + "result_tables/2_output/",
        body=json.dumps({"result": True}),
    )


def get_ok():
    hp.register_uri(
        hp.GET,
        re.compile(META_API_URL + "result_tables/*/"),
        body=json.dumps(
            {
                "errors": {},
                "message": "ok",
                "code": "1500200",
                "result": True,
                "data": {
                    "bk_biz_id": 2,
                    "project_id": 2331,
                    "result_table_id": "2_output",
                    "result_table_name": "output",
                    "result_table_name_alias": "output_alias",
                    "processing_type": "clean",
                    "sensitivity": "output_alias",
                    "created_by": "committer",
                    "created_at": "2018-09-19 17:03:50",
                    "updated_by": None,
                    "updated_at": "2018-09-19 17:03:50",
                    "description": "输出",
                    "concurrency": 0,
                    "data_processing": {
                        "project_id": 1,
                        "processing_id": "xxx",
                        "processing_name": "xxx",
                        "processing_type": "xxx",
                        "created_by ": "xxx",
                        "created_at": "xxx",
                        "updated_by": "xxx",
                        "updated_at": "xxx",
                        "description": "xxx",
                    },
                    "count_freq": 3600,
                    "tags": "",
                    "fields": [
                        {
                            "id": 13730,
                            "result_table_id": "2_output",
                            "field_index": 1,
                            "field_name": "timestamp",
                            "field_alias": "时间",
                            "description": "",
                            "field_type": "timestamp",
                            "is_dimension": 0,
                            "origins": "",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        }
                    ],
                    "storages": {
                        "kafka": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {},
                            "storage_channel": {
                                "id": 1000,
                                "cluster_name": "xxx",
                                "cluster_type": "kafka",
                                "cluster_role": "inner",
                                "cluster_domain": "xxx",
                                "cluster_backup_ips": "xxx",
                                "cluster_port": 2432,
                                "zk_domain": "127.0.0.1",
                                "zk_port": 3481,
                                "zk_root_path": "/abc/defg",
                                "priority": 234,
                                "attribute": "bkdata",
                                "description": "sdfdsf",
                            },
                            "physical_table_name": "xxx",
                            "expires": "xxx",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "hdfs": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "hdfs_test",
                                "cluster_type": "hdfs",
                                "cluster_domain": "xxx",
                                "cluster_group": "hdfs",
                                "connection_info": '{"flush_size": 1000000, "servicerpc_port": 53310, "hdfs_url": '
                                '"hdfs://hdfsTest", "rpc_port": 9000, "interval": 60000, "ids": '
                                '"nn1", "hdfs_cluster_name": "hdfsTest", "topic_dir": "/kafka/data/"'
                                ', "log_dir": "/kafka/logs", "hdfs_default_params": '
                                '{"dfs.replication": 2}, "hosts": "test-master-01", "port": 8081}',
                                "priority": 2,
                                "version": "1234",
                                "belongs": "bkdata",
                            },
                            "storage_channel": {},
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "es": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "es-test",
                                "cluster_type": "es",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "transport": 9300}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "370",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tredis": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tredis-test",
                                "cluster_type": "tredis",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 30000, "password": ""}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "7d",
                            "storage_config": '{"storage_type": "list", "storage_expire_days": 7}',
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "druid": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "druid-test",
                                "cluster_type": "druid",
                                "cluster_domain": "xxx",
                                "cluster_group": "xxx",
                                "connection_info": '{"host": "localhost", "port": 8080, "zookeeper.connect": "XXXXXX"}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "3d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "queue": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "queue-test",
                                "cluster_type": "queue",
                                "cluster_domain": "xxx",
                                "cluster_group": "queue",
                                "connection_info": '{"host": "XXXXXXX", "port": 9092}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "14d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "mysql": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "mysql-test",
                                "cluster_type": "mysql",
                                "cluster_domain": "xxx",
                                "cluster_group": "mysql",
                                "connection_info": '{"host": "127.0.0.1", "port": 3306, "user": "maple", "password": '
                                '""}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "30d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                        "tsdb": {
                            "id": 1,
                            "result_table_id": "xxx",
                            "storage_cluster": {
                                "cluster_name": "tsdb-test",
                                "cluster_type": "tsdb",
                                "cluster_domain": "xxx",
                                "cluster_group": "tsdb",
                                "connection_info": '{"connector_cluster":"tsdb-inner2-M", "tsdb_url": "xxx", "host": '
                                '"localhost", "port": 7085}',
                                "priority": 134,
                                "version": "23423",
                                "belongs": "bkdata",
                            },
                            "physical_table_name": "xxx",
                            "expires": "30d",
                            "storage_config": "{}",
                            "priority": 1,
                            "description": "xxx",
                            "created_by": None,
                            "created_at": None,
                            "updated_by": None,
                            "updated_at": None,
                        },
                    },
                },
            }
        ),
    )


def get_storages_ok(result_table_id):
    hp.register_uri(
        hp.GET,
        re.compile(META_API_URL + "result_tables/%s/storages/" % result_table_id),
        body=json.dumps(
            {
                "errors": {},
                "message": "ok",
                "code": "1500200",
                "result": True,
                "data": {
                    "mysql": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "xxx",
                            "cluster_type": "mysql",
                            "cluster_domain": "xxx",
                            "cluster_group": "xxx",
                            "connection_info": '{"host": "mysql.host", "port": 3306, "user": "mysqluser", '
                            '"password":""}',
                            "priority": 234,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "xxx",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "kafka": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {},
                        "storage_channel": {
                            "id": 1000,
                            "cluster_name": "xxx",
                            "cluster_type": "kafka",
                            "cluster_role": "inner",
                            "cluster_domain": "xxx",
                            "cluster_backup_ips": "xxx",
                            "cluster_port": 2432,
                            "zk_domain": "127.0.0.1",
                            "zk_port": 3481,
                            "zk_root_path": "/abc/defg",
                            "priority": 234,
                            "attribute": "bkdata",
                            "description": "sdfdsf",
                        },
                        "physical_table_name": "xxx",
                        "expires": "xxx",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "hdfs": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "hdfs_test",
                            "cluster_type": "hdfs",
                            "cluster_domain": "xxx",
                            "cluster_group": "hdfs",
                            "connection_info": '{"flush_size": 1000000, "servicerpc_port": 53310, "hdfs_url": '
                            '"hdfs://hdfsTest", "rpc_port": 9000, "interval": 60000, "ids": "nn1", '
                            '"hdfs_cluster_name": "hdfsTest", "topic_dir": "/kafka/data/", "log_dir"'
                            ': "/kafka/logs", "hdfs_default_params": {"dfs.replication": 2}, "hosts"'
                            ': "test-master-01", "port": 8081}',
                            "priority": 2,
                            "version": "1234",
                            "belongs": "bkdata",
                        },
                        "storage_channel": {},
                        "physical_table_name": "xxx",
                        "expires": "3d",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "es": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "es-test",
                            "cluster_type": "es",
                            "cluster_domain": "xxx",
                            "cluster_group": "xxx",
                            "connection_info": '{"host": "localhost", "port": 8080, "transport": 9300}',
                            "priority": 134,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "370",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "tredis": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "tredis-test",
                            "cluster_type": "tredis",
                            "cluster_domain": "xxx",
                            "cluster_group": "xxx",
                            "connection_info": '{"host": "localhost", "port": 30000, "password": ""}',
                            "priority": 134,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "7d",
                        "storage_config": '{"storage_type": "list", "storage_expire_days": 7}',
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "druid": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "druid-test",
                            "cluster_type": "druid",
                            "cluster_domain": "xxx",
                            "cluster_group": "xxx",
                            "connection_info": '{"host": "localhost", "port": 8080, "zookeeper.connect": "xxxxx"}',
                            "priority": 134,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "3d",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "queue": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "queue-test",
                            "cluster_type": "queue",
                            "cluster_domain": "xxx",
                            "cluster_group": "queue",
                            "connection_info": '{"host": "xxxxx", "port": 9092}',
                            "priority": 134,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "14d",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                    "tsdb": {
                        "id": 1,
                        "result_table_id": "xxx",
                        "storage_cluster": {
                            "cluster_name": "tsdb-test",
                            "cluster_type": "tsdb",
                            "cluster_domain": "xxx",
                            "cluster_group": "tsdb",
                            "connection_info": '{"connector_cluster":"tsdb-inner2-M", "tsdb_url": "xxx", "host": '
                            '"localhost", "port": 7085}',
                            "priority": 134,
                            "version": "23423",
                            "belongs": "bkdata",
                        },
                        "physical_table_name": "xxx",
                        "expires": "30d",
                        "storage_config": "{}",
                        "priority": 1,
                        "description": "xxx",
                        "created_by": None,
                        "created_at": None,
                        "updated_by": None,
                        "updated_at": None,
                    },
                },
            }
        ),
        priority=10,
    )


def list_ok():
    hp.register_uri(
        hp.GET,
        META_API_URL + "result_tables/",
        body=json.dumps(
            {
                "errors": None,
                "message": "ok",
                "code": "1500200",
                "data": [
                    {
                        "bk_biz_id": 100115,
                        "result_table_name_alias": "静态关联清洗",
                        "project_name": "测试项目",
                        "count_freq": 0,
                        "updated_by": "",
                        "created_at": "2019-03-24 17:32:03",
                        "processing_type": "clean",
                        "updated_at": "2019-03-24 17:32:03",
                        "created_by": "user1",
                        "result_table_type": None,
                        "result_table_name": "csvtest",
                        "generate_type": "user",
                        "sensitivity": "public",
                        "storages": {
                            "kafka": {
                                "storage_channel": {
                                    "cluster_name": "testinner",
                                    "description": "",
                                    "cluster_backup_ips": "",
                                    "cluster_domain": "kafka.domain",
                                    "attribute": "bkdata",
                                    "cluster_port": 9092,
                                    "cluster_role": "inner",
                                    "zk_port": 2181,
                                    "id": 10,
                                    "priority": 5,
                                    "cluster_type": "kafka",
                                    "active": True,
                                    "channel_cluster_config_id": 10,
                                    "zk_domain": "zk.domain",
                                    "zk_root_path": "/kafka-test-3",
                                },
                                "expires": "3",
                                "description": "清洗表存储",
                                "created_at": "2019-03-24 17:32:04",
                                "storage_channel_id": 10,
                                "storage_config": "{}",
                                "updated_at": "2019-03-24 17:32:04",
                                "created_by": "user1",
                                "id": 3289,
                                "priority": 5,
                                "storage_cluster_config_id": None,
                                "generate_type": "user",
                                "active": True,
                                "storage_cluster": {},
                                "physical_table_name": "table_100115_csvtest",
                                "result_table_id": "100115_csvtest",
                                "updated_by": "",
                            }
                        },
                        "project_id": 4,
                        "result_table_id": "100115_csvtest",
                        "description": "静态关联清洗",
                    }
                ],
                "result": True,
            }
        ),
    )


def get_databus_old_ok():
    hp.register_uri(
        hp.GET,
        OLD_DATABUS_API_URL + "shipper/stop_databus_task",
        body=json.dumps({"result": True}),
    )
